<!DOCTYPE html>
<html>
  <head>
    <title>Console This</title>
    <meta name="viewport" 
    content="width=device-width,initial-scale=1">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default">
    </script>
    <script src="https://www.gstatic.com/external_hosted/handlebars/v4.7.6/handlebars.min.js">
    </script>
    <link href="https://fonts.googleapis.com/css?family=Roboto" 
    rel="stylesheet">
    <link rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" 
    integrity="sha512-8bHTC73gkZ7rZ7vpqUQThUDhqcNFyYi2xgDgPDHc+GXVGHXq+xPjynxIopALmOPqzo9JZj0k6OqqewdGO3EsrQ==" 
    crossorigin="anonymous"/> 
    <script src ="assets/script.js"></script>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #map-container {
        width: 100%;
        height: 600px;
        position: relative;
        font-family: "Roboto", sans-serif;
        box-sizing: border-box;
      }

      #map-container button {
        background: none;
        color: inherit;
        border: none;
        padding: 0;
        font: inherit;
        font-size: inherit;
        cursor: pointer;
      }

      #map {
        position: absolute;
        left: 25em;
        top: 0;
        right: 0;
        bottom: 0;
      }

      #locations-panel {
        position: absolute;
        left: 0;
        width: 22em;
        top: 0;
        bottom: 0;
        overflow-y: auto;
        background: white;
        padding: 0.5em;
        box-sizing: border-box;
      }

      @media only screen and (max-width: 876px) {
        #map {
          left: 0;
          bottom: 50%;
        }

        #locations-panel {
          top: 50%;
          right: 0;
          width: unset;
        }
      }

      #locations-panel-list > header {
        padding: 1.4em 1.4em 0 1.4em;
      }

      #locations-panel-list h1.search-title {
        font-size: 1em;
        font-weight: 500;
        margin: 0;
      }

      #locations-panel-list h1.search-title > img {
        vertical-align: bottom;
        margin-top: -1em;
      }

      #locations-panel-list .search-input {
        width: 100%;
        margin-top: 0.8em;
        position: relative;
      }

      #locations-panel-list .search-input input {
        width: 100%;
        border: 1px solid rgba(0, 0, 0, 0.2);
        border-radius: 0.3em;
        height: 2.2em;
        box-sizing: border-box;
        padding: 0 2.5em 0 1em;
        font-size: 1em;
      }

      #locations-panel-list .search-input-overlay {
        position: absolute;
      }

      #locations-panel-list .search-input-overlay.search {
        right: 2px;
        top: 2px;
        bottom: 2px;
        width: 2.4em;
      }

      #locations-panel-list .search-input-overlay.search button {
        width: 100%;
        height: 100%;
        border-radius: 0.2em;
        color: black;
        background: transparent;
      }

      #locations-panel-list .search-input-overlay.search .icon {
        margin-top: 0.05em;
        vertical-align: top;
      }

      #locations-panel-list .section-name {
        font-weight: 500;
        font-size: 0.9em;
        margin: 1.8em 0 1em 1.5em;
      }

      #locations-panel-list .location-result {
        position: relative;
        padding: 0.8em 3.5em 0.8em 1.4em;
        border-bottom: 1px solid rgba(0, 0, 0, 0.12);
        cursor: pointer;
      }

      #locations-panel-list .location-result:first-of-type {
        border-top: 1px solid rgba(0, 0, 0, 0.12);
      }

      #locations-panel-list .location-result:last-of-type {
        border-bottom: none;
      }

      #locations-panel-list .location-result.selected {
        outline: 2px solid #4285f4;
      }

      #locations-panel-list button.select-location {
        margin-bottom: 0.6em;
        text-align: left;
      }

      #locations-panel-list .location-result h2.name {
        font-size: 1em;
        font-weight: 500;
        margin: 0;
      }

      #locations-panel-list .location-result .address {
        font-size: 0.9em;
        margin-bottom: 0.5em;
      }

      #locations-panel-list .location-result .distance {
        position: absolute;
        top: 0.9em;
        right: 0;
        text-align: center;
        font-size: 0.9em;
        width: 5em;
      }

      #location-results-list {
        list-style-type: none;
        margin: 0;
        padding: 0;
      }
    </style>
    <script>
      'use strict';

      /**
       * Defines an instance of the Locator+ solution, to be instantiated
       * when the Maps library is loaded.
       */
      function LocatorPlus(configuration) {
        const locator = this;

        locator.locations = configuration.locations || [];
        locator.capabilities = configuration.capabilities || {};

        const mapEl = document.getElementById('map');
        const panelEl = document.getElementById('locations-panel');
        locator.panelListEl = document.getElementById('locations-panel-list');
        const sectionNameEl =
            document.getElementById('location-results-section-name');
        const resultsContainerEl = document.getElementById('location-results-list');

        const itemsTemplate = Handlebars.compile(
            document.getElementById('locator-result-items-tmpl').innerHTML);

        locator.searchLocation = null;
        locator.searchLocationMarker = null;
        locator.selectedLocationIdx = null;
        locator.userCountry = null;

        // Initialize the map -------------------------------------------------------
        locator.map = new google.maps.Map(mapEl, configuration.mapOptions);

        // Store selection.
        const selectResultItem = function(locationIdx, panToMarker, scrollToResult) {
          locator.selectedLocationIdx = locationIdx;
          for (let locationElem of resultsContainerEl.children) {
            locationElem.classList.remove('selected');
            if (getResultIndex(locationElem) === locator.selectedLocationIdx) {
              locationElem.classList.add('selected');
              if (scrollToResult) {
                panelEl.scrollTop = locationElem.offsetTop;
              }
            }
          }
          if (panToMarker && (locationIdx != null)) {
            locator.map.panTo(locator.locations[locationIdx].coords);
          }
        };

        // Create a marker for each location.
        const markers = locator.locations.map(function(location, index) {
          const marker = new google.maps.Marker({
            position: location.coords,
            map: locator.map,
            title: location.title,
          });
          marker.addListener('click', function() {
            selectResultItem(index, false, true);
          });
          return marker;
        });

        // Fit map to marker bounds.
        locator.updateBounds = function() {
          const bounds = new google.maps.LatLngBounds();
          if (locator.searchLocationMarker) {
            bounds.extend(locator.searchLocationMarker.getPosition());
          }
          for (let i = 0; i < markers.length; i++) {
            bounds.extend(markers[i].getPosition());
          }
          locator.map.fitBounds(bounds);
        };
        if (locator.locations.length) {
          locator.updateBounds();
        }

        // Get the distance of a store location to the user's location,
        // used in sorting the list.
        const getLocationDistance = function(location) {
          if (!locator.searchLocation) return null;

          // Use travel distance if available (from Distance Matrix).
          if (location.travelDistanceValue != null) {
            return location.travelDistanceValue;
          }

          // Fall back to straight-line distance.
          return google.maps.geometry.spherical.computeDistanceBetween(
              new google.maps.LatLng(location.coords),
              locator.searchLocation.location);
        };

        // Render the results list --------------------------------------------------
        const getResultIndex = function(elem) {
          return parseInt(elem.getAttribute('data-location-index'));
        };

        locator.renderResultsList = function() {
          let locations = locator.locations.slice();
          for (let i = 0; i < locations.length; i++) {
            locations[i].index = i;
          }
          if (locator.searchLocation) {
            sectionNameEl.textContent =
                'Nearest locations (' + locations.length + ')';
            locations.sort(function(a, b) {
              return getLocationDistance(a) - getLocationDistance(b);
            });
          } else {
            sectionNameEl.textContent = `All locations (${locations.length})`;
          }
          const resultItemContext = { locations: locations };
          resultsContainerEl.innerHTML = itemsTemplate(resultItemContext);
          for (let item of resultsContainerEl.children) {
            const resultIndex = getResultIndex(item);
            if (resultIndex === locator.selectedLocationIdx) {
              item.classList.add('selected');
            }

            const resultSelectionHandler = function() {
              selectResultItem(resultIndex, true, false);
            };

            // Clicking anywhere on the item selects this location.
            // Additionally, create a button element to make this behavior
            // accessible under tab navigation.
            item.addEventListener('click', resultSelectionHandler);
            item.querySelector('.select-location')
                .addEventListener('click', function(e) {
                  resultSelectionHandler();
                  e.stopPropagation();
                });
          }
        };

        // Optional capability initialization --------------------------------------
        initializeSearchInput(locator);
        initializeDistanceMatrix(locator);

        // Initial render of results -----------------------------------------------
        locator.renderResultsList();
      }

      /** When the search input capability is enabled, initialize it. */
      function initializeSearchInput(locator) {
        const geocodeCache = new Map();
        const geocoder = new google.maps.Geocoder();

        const searchInputEl = document.getElementById('location-search-input');
        const searchButtonEl = document.getElementById('location-search-button');

        const updateSearchLocation = function(address, location) {
          if (locator.searchLocationMarker) {
            locator.searchLocationMarker.setMap(null);
          }
          if (!location) {
            locator.searchLocation = null;
            return;
          }
          locator.searchLocation = {'address': address, 'location': location};
          locator.searchLocationMarker = new google.maps.Marker({
            position: location,
            map: locator.map,
            title: 'My location',
            icon: {
              path: google.maps.SymbolPath.CIRCLE,
              scale: 12,
              fillColor: '#3367D6',
              fillOpacity: 0.5,
              strokeOpacity: 0,
            }
          });

          // Update the locator's idea of the user's country, used for units. Use
          // `formatted_address` instead of the more structured `address_components`
          // to avoid an additional billed call.
          const addressParts = address.split(' ');
          locator.userCountry = addressParts[addressParts.length - 1];

          // Update map bounds to include the new location marker.
          locator.updateBounds();

          // Update the result list so we can sort it by proximity.
          locator.renderResultsList();

          locator.updateTravelTimes();
        };

        const geocodeSearch = function(query) {
          if (!query) {
            return;
          }

          const handleResult = function(geocodeResult) {
            searchInputEl.value = geocodeResult.formatted_address;
            updateSearchLocation(
                geocodeResult.formatted_address, geocodeResult.geometry.location);
          };

          if (geocodeCache.has(query)) {
            handleResult(geocodeCache.get(query));
            return;
          }
          const request = {address: query, bounds: locator.map.getBounds()};
          geocoder.geocode(request, function(results, status) {
            if (status === 'OK') {
              if (results.length > 0) {
                const result = results[0];
                geocodeCache.set(query, result);
                handleResult(result);
              }
            }
          });
        };

        // Set up geocoding on the search input.
        searchButtonEl.addEventListener('click', function() {
          geocodeSearch(searchInputEl.value.trim());
        });

        // Initialize Autocomplete.
        initializeSearchInputAutocomplete(
            locator, searchInputEl, geocodeSearch, updateSearchLocation);
      }

      /** Add Autocomplete to the search input. */
      function initializeSearchInputAutocomplete(
          locator, searchInputEl, fallbackSearch, searchLocationUpdater) {
        // Set up Autocomplete on the search input. Bias results to map viewport.
        const autocomplete = new google.maps.places.Autocomplete(searchInputEl, {
          types: ['geocode'],
          fields: ['place_id', 'formatted_address', 'geometry.location']
        });
        autocomplete.bindTo('bounds', locator.map);
        autocomplete.addListener('place_changed', function() {
          const placeResult = autocomplete.getPlace();
          if (!placeResult.geometry) {
            // Hitting 'Enter' without selecting a suggestion will result in a
            // placeResult with only the text input value as the 'name' field.
            fallbackSearch(placeResult.name);
            return;
          }
          searchLocationUpdater(
              placeResult.formatted_address, placeResult.geometry.location);
        });
      }

      /** Initialize Distance Matrix for the locator. */
      function initializeDistanceMatrix(locator) {
        const distanceMatrixService = new google.maps.DistanceMatrixService();

        // Annotate travel times to the selected location using Distance Matrix.
        locator.updateTravelTimes = function() {
          if (!locator.searchLocation) return;

          const units = (locator.userCountry === 'USA') ?
              google.maps.UnitSystem.IMPERIAL :
              google.maps.UnitSystem.METRIC;
          const request = {
            origins: [locator.searchLocation.location],
            destinations: locator.locations.map(function(x) {
              return x.coords;
            }),
            travelMode: google.maps.TravelMode.DRIVING,
            unitSystem: units,
          };
          const callback = function(response, status) {
            if (status === 'OK') {
              const distances = response.rows[0].elements;
              for (let i = 0; i < distances.length; i++) {
                const distResult = distances[i];
                let travelDistanceText, travelDistanceValue;
                if (distResult.status === 'OK') {
                  travelDistanceText = distResult.distance.text;
                  travelDistanceValue = distResult.distance.value;
                }
                const location = locator.locations[i];
                location.travelDistanceText = travelDistanceText;
                location.travelDistanceValue = travelDistanceValue;
              }

              // Re-render the results list, in case the ordering has changed.
              locator.renderResultsList();
            }
          };
          distanceMatrixService.getDistanceMatrix(request, callback);
        };
      }
    </script>
    <script>
      const CONFIGURATION = {
        "locations": [
          {"title":"Best Buy","address1":"1236 Galleria Blvd","address2":"Roseville, CA 95678, USA","coords":{"lat":38.773967569725755,"lng":-121.26120702394256},"placeId":"ChIJL1jMlX0fm4ARuawgr4G07Y8"},
          {"title":"Best Buy","address1":"6110 Birdcage Centre Ln","address2":"Citrus Heights, CA 95610, USA","coords":{"lat":38.67574242402312,"lng":-121.27526836256561},"placeId":"ChIJ1R5zyyTemoARxHbB5PvG_T8"},
          {"title":"Best Buy","address1":"2445 Iron Point Rd","address2":"Folsom, CA 95630, USA","coords":{"lat":38.645230906904644,"lng":-121.1214216490738},"placeId":"EikyNDQ1IElyb24gUG9pbnQgUmQsIEZvbHNvbSwgQ0EgOTU2MzAsIFVTQSJREk8KNAoyCesAxR0J5ZqAEeiBEwmNh8CCGh4LEO7B7qEBGhQKEgnNMg8isuOagBGR6zVGNF76bAwQjRMqFAoSCf9fMbqx5ZqAEXXM-a7QSPxF"},
          {"title":"Best Buy","address1":"1901 Arden Way","address2":"Sacramento, CA 95815, USA","coords":{"lat":38.598730372286425,"lng":-121.42105804907379},"placeId":"ChIJJXO97CLamoAR7p4Uo20I8b8"},
          {"title":"Best Buy","address1":"3690 N Freeway Blvd","address2":"Sacramento, CA 95834, USA","coords":{"lat":38.63776559546612,"lng":-121.49581936441803},"placeId":"ChIJw3znw0vWmoAR4W8S0b3kUcA"},
          {"title":"Best Buy","address1":"1760 Grass Valley Hwy","address2":"Auburn, CA 95603, USA","coords":{"lat":38.92913812417697,"lng":-121.08625147790984},"placeId":"ChIJI0c1R6kam4ARPapD1jZ3hK4"}
        ],
        "mapOptions": {"center":{"lat":38.0,"lng":-100.0},"fullscreenControl":true,"mapTypeControl":false,"streetViewControl":false,"zoom":4,"zoomControl":true,"maxZoom":17},
        "mapsApiKey": "AIzaSyBAB6_XNjw9zwRp8ZiuKxiY7X89-I-ZMto"
      };

      function initMap() {
        new LocatorPlus(CONFIGURATION);
      }
    </script>
    <script id="locator-result-items-tmpl" type="text/x-handlebars-template">
      {{#each locations}}
        <li class="location-result" data-location-index="{{index}}">
          <button class="select-location">
            <h2 class="name">{{title}}</h2>
          </button>
          <div class="address">{{address1}}<br>{{address2}}</div>
          {{#if travelDistanceText}}
            <div class="distance">{{travelDistanceText}}</div>
          {{/if}}
        </li>
      {{/each}}
    </script>
  </head>
  <body>
    <header class="ui segment">
        <h1 class = "ui center aligned header">
            CONSOLE THIS
        </h1>
        <p class = "ui center aligned purple header"> Making gaming easier to find and enjoy!</p>
    </header>

    <!--     CONSOLES      -->
    <div class="ui equal width horizantally padded grid">
        <div class="row">
          <div class="column">
              <!--change console IDs to SKU #s-->
              <div id="6364255" class="ui center aligned purple inverted segment" onclick="selectConsole(this.id)">Nintendo Switch<a href="#" class ="ui medium image"><img src="assets/pics/1280px-Nintendo-Switch-wJoyCons-BlRd-Standing-FL.png"></a></div>
          </div>
          <div class="column">
              <div id="6257135" class="ui center aligned purple inverted segment" onclick="selectConsole(this.id)">Nintendo Switch Lite<a href="#" class ="ui medium image"><img src="assets/pics/NSwitch_SwitchLite_Home_Menu_Hardware.png"></a></div>
          </div>
          <div class="column">
              <div id="6470923" class="ui center aligned purple inverted segment" onclick="selectConsole(this.id)">Nintendo Switch OLED<a href="#" class="ui medium image"><img src="assets/pics/Nintendo_Switch_OLED.png" /></a>  </div>
          </div>
          <div class="column">
              <div id="6426149" class="ui center aligned purple inverted segment" onclick="selectConsole(this.id)">Playstation 5<a href="#" class="ui medium image"><img href src="assets/pics/playstation-5-with-dualsense-front-product-shot-01-ps5-en-30jul20.png" /></a></div>
          </div>
          <div class="column">
              <div id="6428324" class="ui center aligned purple inverted segment" onclick="selectConsole(this.id)">Xbox Series X<a href="#" class ="ui medium image"><img src="assets/pics/xboxx.png"></a></div>
          </div>
          <div class="column">
              <div id="6430277" class="ui center aligned purple inverted segment" onclick="selectConsole(this.id)">Xbox Series S<a href="#" class ="ui medium image"><img src="assets/pics/fcb5fbdf-009b-4a09-8850-e2825a84f89a.png"></a></div>
            </div>
        </div>    
    </div>
    <div id="map-container">
        <div id="locations-panel">
          <div id="locations-panel-list">
            <header>
              <h1 class="search-title">
                <img src="https://fonts.gstatic.com/s/i/googlematerialicons/place/v15/24px.svg"/>
                Find a location near you
              </h1>
              <div class="search-input">
                <input id="userZip" onkeyup="queryStore()" placeholder="Enter your address or zip code">
                <div id="search-overlay-search" class="search-input-overlay search">
                  <button id="location-search-button">
                    <img class="icon" src="https://fonts.gstatic.com/s/i/googlematerialicons/search/v11/24px.svg" alt="Search"/>
                  </button>
                </div>
              </div>
            </header>
            <div class="section-name" id="location-results-section-name">
              All locations
            </div>
            <div class="results">
              <ul id="location-results-list"></ul>
            </div>
          </div>
        </div>
        <div id="map"></div>
      </div>    

    <!-- STORE LINKS & ADDRESS -->
  <div class="ui four column horizantally padded grid">
    <div class="two column row">
      <div class="column">
          <div id="storeNameLeft" class="ui center aligned violet inverted segment">
              Store Name (link) Address (maps) LEFT
            </div> 
        </div>

        <div class="column">
            <div id="storeNameRight" class="ui center aligned violet inverted segment">
                Store Name (link) Address (maps) RIGHT
            </div> 
        </div>
    </div>

    <!--  LEFT  -->
    <div class="column">
        <div id="consoleNameLeft" class="ui center aligned violet inverted segment">
            (Console name or picture)LEFT
        </div> 
    </div>

    <div class="column">
        <div id="quantityLeft" class="ui center aligned violet inverted segment">
            Quantity
            (link to direct)LEFT
            </div> 
    </div>

    <!--  RIGHT SIDE  -->
    <div class="column">
        <div id="consoleNameRight" class="ui center aligned violet inverted segment">
            (Console name or picture) RIGHT           
        </div> 
    </div>

    <div class="column">
        <div id="quantityRight" class="ui center aligned violet inverted segment">
            Quantity
            (link to direct) RIGHT

        </div> 
    </div>
    <!--  LEFT 
    <div class="column">
        <div class="ui center aligned violet inverted segment">
            (Console name or picture)LEFT
        </div> 
    </div>

    <div class="column">
        <div class="ui center aligned violet inverted segment">
            Quantity
            (link to direct) LEFT
        </div> 
    </div>

    <!--  RIGHT 
    <div class="column">
        <div class="ui center aligned violet inverted segment">
            (Console name or picture) RIGHT

        </div> 
    </div>

    <div class="column">
        <div class="ui center aligned violet inverted segment">
            Quantity
            (link to direct) RIGHT
        -->
        </div> 
    </div>

  </div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBAB6_XNjw9zwRp8ZiuKxiY7X89-I-ZMto&callback=initMap&libraries=places,geometry&solution_channel=GMP_QB_locatorplus_v4_cABD" async defer></script>
  </body>
</html>
